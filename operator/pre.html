<html><head><title>VinylDNS: Pre-requisites</title><meta charset="utf-8" /><meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1" /><meta name="viewport" content="width=device-width, initial-scale=1.0" /><meta name="author" content="VinylDNS" /><meta name="description" content="DNS Management Platform" /><meta name="og:image" content="/img/poster.png" /><meta name="og:title" content="VinylDNS: Pre-requisites" /><meta name="og:site_name" content="VinylDNS" /><meta name="og:url" content="http://vinyldns.io" /><meta name="og:type" content="website" /><meta name="og:description" content="DNS Management Platform" /><link rel="icon" type="image/png" href="/img/favicon.png" /><meta name="twitter:title" content="VinylDNS: Pre-requisites" /><meta name="twitter:image" content="http://vinyldns.ioimg/poster.png" /><meta name="twitter:description" content="DNS Management Platform" /><meta name="twitter:card" content="summary_large_image" /><link rel="icon" type="image/png" sizes="16x16" href="/img/favicon16x16.png" /><link rel="icon" type="image/png" sizes="24x24" href="/img/favicon24x24.png" /><link rel="icon" type="image/png" sizes="32x32" href="/img/favicon32x32.png" /><link rel="icon" type="image/png" sizes="48x48" href="/img/favicon48x48.png" /><link rel="icon" type="image/png" sizes="57x57" href="/img/favicon57x57.png" /><link rel="icon" type="image/png" sizes="60x60" href="/img/favicon60x60.png" /><link rel="icon" type="image/png" sizes="64x64" href="/img/favicon64x64.png" /><link rel="icon" type="image/png" sizes="70x70" href="/img/favicon70x70.png" /><link rel="icon" type="image/png" sizes="72x72" href="/img/favicon72x72.png" /><link rel="icon" type="image/png" sizes="76x76" href="/img/favicon76x76.png" /><link rel="icon" type="image/png" sizes="96x96" href="/img/favicon96x96.png" /><link rel="icon" type="image/png" sizes="114x114" href="/img/favicon114x114.png" /><link rel="icon" type="image/png" sizes="120x120" href="/img/favicon120x120.png" /><link rel="icon" type="image/png" sizes="128x128" href="/img/favicon128x128.png" /><link rel="icon" type="image/png" sizes="144x144" href="/img/favicon144x144.png" /><link rel="icon" type="image/png" sizes="150x150" href="/img/favicon150x150.png" /><link rel="icon" type="image/png" sizes="152x152" href="/img/favicon152x152.png" /><link rel="icon" type="image/png" sizes="196x196" href="/img/favicon196x196.png" /><link rel="icon" type="image/png" sizes="310x310" href="/img/favicon310x310.png" /><link rel="icon" type="image/png" sizes="310x150" href="/img/favicon310x150.png" /><link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/css/bootstrap.min.css" /><link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/font-awesome/4.7.0/css/font-awesome.min.css" /><link rel="stylesheet" href="/highlight/styles/default.css" /><link rel="stylesheet" href="/css/style.css" /><link rel="stylesheet" href="/css/palette.css" /><link rel="stylesheet" href="/css/codemirror.css" /><link rel="stylesheet" href="/css/custom.css" /></head><body class="docs"><div id="wrapper"><div id="sidebar-wrapper"><ul id="sidebar" class="sidebar-nav"><li class="sidebar-brand"><a href="/" class="brand"><div class="brand-wrapper"><span>VinylDNS</span></div></a></li>       <li><a href="/operator/index.html" class="">Operator Guide</a></li> <li><a href="/operator/pre" class=" active ">Pre-requisites</a> <ul class="sub_section"> <li><a href="/operator/setup-dynamodb" class="">Setup AWS DynamoDB</a></li> <li><a href="/operator/setup-mysql" class="">Setup MySQL</a></li> <li><a href="/operator/setup-sqs" class="">Setup AWS SQS</a></li> <li><a href="/operator/setup-ldap" class="">Setup LDAP</a></li></ul></li> <li><a href="/operator/setup-api" class="">Setup API Server</a> <ul class="sub_section"> <li><a href="/operator/config-api" class="">API Configuration Guide</a></li></ul></li> <li><a href="/operator/setup-portal" class="">Setup the Portal Server</a> <ul class="sub_section"> <li><a href="/operator/config-portal" class="">Portal Configuration Guide</a></li></ul></li>      </ul></div><div id="page-content-wrapper"><div class="nav"><div class="container-fluid"><div class="row"><div class="col-lg-12"><div class="action-menu pull-left clearfix"><a href="#menu-toggle" id="menu-toggle"><i class="fa fa-bars" aria-hidden="true"></i></a></div><ul class="pull-right"><li id="gh-eyes-item" class="hidden-xs"><a href="https://github.com/VinylDNS/vinyldns"><i class="fa fa-eye"></i><span>WATCH<span id="eyes" class="label label-default">--</span></span></a></li><li id="gh-stars-item" class="hidden-xs"><a href="https://github.com/VinylDNS/vinyldns"><i class="fa fa-star-o"></i><span>STARS<span id="stars" class="label label-default">--</span></span></a></li></ul></div></div></div></div><div id="content" data-github-owner="VinylDNS" data-github-repo="vinyldns"><div class="content-wrapper"><section><h1 id="vinyldns-pre-requisites">VinylDNS Pre-requisites</h1>
<p>VinylDNS has the following external requirements that need to be setup so that VinylDNS can operate.  Those include:</p>

<ol>
  <li><a href="#dns">DNS</a> - your DNS servers VinylDNS will interact with</li>
  <li><a href="#database">Database</a> - the database houses all of VinylDNS information including history, records, zones, and users</li>
  <li><a href="#message-queues">Message Queue</a> - the message queue supports high-availability and throttling of commands to DNS backend servers</li>
  <li><a href="#ldap">LDAP</a> - ldap supports both authentication as well as the source of truth for users that are managed inside the VinylDNS database</li>
</ol>

<h2 id="dns">DNS</h2>
<p>VinylDNS is <strong>not a DNS</strong>, rather it integrates with your existing DNS installations to enable DNS self-service and streamline
DNS operations.</p>

<p>VinylDNS communicates to your DNS via:</p>
<ul>
  <li><code class="highlighter-rouge">DDNS</code> - DDNS is used for all record updates</li>
  <li><code class="highlighter-rouge">AXFR</code> - Zone Transfers are used to load DNS records into the VinylDNS database.</li>
</ul>

<p>VinylDNS communicates to your DNS using “connections”.  A connection allows you to specify:</p>
<ol>
  <li>The TSIG key name</li>
  <li>The TSIG key secret</li>
  <li>The server (and optionally port) to communicate to DNS with</li>
</ol>

<p>There are <strong>2</strong> connections, one for DDNS and another for zone transfers.  This allows you to use a different DNS server / key
for zone transfers.</p>

<p>Connections (DDNS and Transfer) can be setup</p>
<ul>
  <li><code class="highlighter-rouge">per zone</code> - every zone can override the global default by specifying its own connections.</li>
  <li><code class="highlighter-rouge">global default</code> - assuming you are managing a primary system, you can <a href="config-api#default-zone-connections">configure default zone connections</a>.
When no zone connection is specified on a zone, the global defaults will be used.</li>
</ul>

<h2 id="database">Database</h2>

<p>The VinylDNS database has a <code class="highlighter-rouge">NoSQL</code> / non-relational design to it.  Instead of having a heavily normalized set of SQL tables
that surface in the system, VinylDNS relies on <code class="highlighter-rouge">Repositories</code> where each <code class="highlighter-rouge">Repository</code> is independent of each one another.
This allows implementers to best map each <code class="highlighter-rouge">Repository</code> into the data-store of choice.</p>

<p>As <code class="highlighter-rouge">Repositories</code> are independent, there are no “transactions” that span repositories.  Each <code class="highlighter-rouge">Repository</code> implementation
can choose to use transactions if it maps to multiple tables within itself.</p>

<p>There are <strong>links</strong> across repositories, for example the <code class="highlighter-rouge">RecordSet.id</code> would be referenced in a <code class="highlighter-rouge">RecordSetChangeRepository</code>.</p>

<p>The following are the repositories presently used by VinylDNS:</p>

<ul>
  <li><code class="highlighter-rouge">RecordSetRepository</code> - Instead of individual DNS records, VinylDNS works at the <code class="highlighter-rouge">RRSet</code>.  The unique key for RecordSet is
the <code class="highlighter-rouge">record name</code> + <code class="highlighter-rouge">record type</code></li>
  <li><code class="highlighter-rouge">RecordChangeRepository</code> - The history of all changes to all records in VinylDNS.  In general, some kind of pruning strategy
should be implemented otherwise this could get quite large</li>
  <li><code class="highlighter-rouge">ZoneRepository</code> - DNS Zones and managing access to zones</li>
  <li><code class="highlighter-rouge">ZoneChangeRepository</code> - The history of all changes made to <em>zones</em> in VinylDNS.  Zone changes can including syncs,
updating ACL rules, changing zone ownership, etc.</li>
  <li><code class="highlighter-rouge">GroupRepository</code> - VinylDNS Groups</li>
  <li><code class="highlighter-rouge">UserRepository</code> - VinylDNS Users.  These users are typically created the first time the user logs into the portal.
The user information will be pulled from LDAP, and inserted into the VinylDNS UserRepository</li>
  <li><code class="highlighter-rouge">MembershipRepository</code> - Holds a link from users to groups</li>
  <li><code class="highlighter-rouge">GroupChangeRepository</code> - Holds changes to groups and membership</li>
  <li><code class="highlighter-rouge">BatchChangeRepository</code> - VinylDNS allows users to submit multiple record changes <em>across</em> DNS zones at the same time within a <code class="highlighter-rouge">Batch</code>
The <code class="highlighter-rouge">BatchChangeRepository</code> holds the batch itself and all individual changes that executed in the batch.</li>
  <li><code class="highlighter-rouge">UserChangeRepository</code> - Holds changes to users. Currently only used in the portal.</li>
</ul>

<h2 id="database-types">Database Types</h2>
<h3 id="mysql">MySQL</h3>
<p>VinylDNS has implemented MySQL for all repositories so a MySQL-only instance of VinylDNS is possible. Furthermore, there are two
repositories that have <em>only</em> been implemented in MySQL:</p>

<ol>
  <li>ZoneRepository</li>
  <li>BatchChangeRepository</li>
</ol>

<p>Originally, the <code class="highlighter-rouge">ZoneRepository</code> lived in DynamoDB.  However, the access controls in VinylDNS made it very difficult
to use DynamoDB as the query interface is limited.  A SQL interface with <code class="highlighter-rouge">JOIN</code>s was required.</p>

<p>It should also be noted that all of the repositories have also been implemented in MySQL despite most currently running
in DynamoDB in our VinylDNS instance.</p>

<p>Review the <a href="setup-mysql">Setup MySQL Guide</a> for more information.</p>

<h3 id="aws-dynamodb">AWS DynamoDB</h3>
<p>VinylDNS has gone through several architecture evolutions.  Along the way, DynamoDB was chosen as the data store due to
the volume of data at Comcast.  It is an excellent key-value store with extremely high performance characteristics.</p>

<p>VinylDNS has implemented DynamoDB for the following repositories:</p>

<ol>
  <li>RecordSetRepository</li>
  <li>RecordChangeRepository</li>
  <li>ZoneChangeRepository</li>
  <li>GroupRepository</li>
  <li>UserRepository</li>
  <li>MembershipRepository</li>
  <li>GroupChangeRepository</li>
  <li>UserChangeRepository</li>
</ol>

<p>Currently using DynamoDB would also require the user to either use MySQL for the batch change and zone repositories or also provide
an implementation for those repositories in a different data store.</p>

<p>Review the <a href="setup-dynamodb">Setup AWS DynamoDB Guide</a> for more information.</p>

<h2 id="message-queues">Message Queues</h2>
<p>Most operations that take place in VinylDNS use a message queue.  These operations require high-availability, fault-tolerance
with retry, and throttling.  The message queue supports these characteristics in VinylDNS.</p>

<p>Some operations do not use the message queue, these include user and group changes as they do not carry the same
fault-tolerance and throttling requirements.</p>

<h2 id="message-queue-types">Message Queue Types</h2>
<h3 id="aws-sqs">AWS SQS</h3>
<p>Our VinylDNS instance uses AWS SQS to fulfill its message queue service needs.  SQS has the following characteristics:</p>

<ol>
  <li>High-Availability</li>
  <li>Retry - in the event that a message cannot be processed, or if a node fails midstream processing, it will be automatically
made available for another node to process</li>
  <li>Back-pressure - SQS is a <em>pull based</em> system, meaning that if VinylDNS is currently busy, new messages will not be pulled for processing.
As soon as a node becomes available, the message will be pulled.  This is much preferable to a <em>push</em> based system, where
bottlenecks in processing could cause an increase in heap pressure in the API nodes themselves.</li>
  <li>Price - SQS is very reasonably priced.  Comcast operates multiple message queues for different environments (dev, staging, prod, etc).
The price to use SQS is in the single digit dollars per month.  VinylDNS can be tuned to run exclusively in the <em>free tier</em>.</li>
</ol>

<p>Review the <a href="setup-sqs">Setup AWS SQS Guide</a> for more information.</p>

<h3 id="mysql-1">MySQL</h3>
<p>VinylDNS has also implemented a message queue using MySQL, which incorporates the features that we currently utilize through AWS SQS
such as changing visibility timeout and re-queuing operations.</p>

<p>Review the <a href="setup-mysql">Setup MySQL Guide</a> for more information.</p>

<h2 id="ldap">LDAP</h2>
<p>VinylDNS uses LDAP in order to authenticate users in the <strong>Portal</strong>.  LDAP is <strong>not</strong> used in the API, instead the API uses
its own user and group database for authentication.</p>

<p>When a user first logs into VinylDNS, their user information (first name, last name, user name, email) will be pulled from
LDAP, and stored in the <code class="highlighter-rouge">UserRepository</code>.  Credentials will also be generated for the user and stored encrypted in the <code class="highlighter-rouge">UserRepository</code>.</p>

<p>Review the <a href="setup-ldap">Setup LDAP Guide</a> for more information</p>
</section><div class="edit-button"><a href="https://github.com/VinylDNS/vinyldns/edit/master/modules/docs/src/main/tut/operator/pre.md" class="btn-sm btn-info">Improve this page</a></div></div></div></div></div><script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/1.11.3/jquery.min.js"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.3.7/js/bootstrap.min.js"></script><script src="/highlight/highlight.pack.js"></script><script>hljs.configure({languages:['scala','java','bash']});
hljs.initHighlighting();
              </script><script>((window.gitter = {}).chat = {}).options = {
room: 'vinyldns/Lobby'};</script><script src="https://sidecar.gitter.im/dist/sidecar.v1.js"></script><script src="/js/main.js"></script></body></html>